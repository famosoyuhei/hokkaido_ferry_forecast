# LINEé€šçŸ¥æ©Ÿèƒ½

åŒ—æµ·é“ãƒ•ã‚§ãƒªãƒ¼äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ ã®LINEé€šçŸ¥æ©Ÿèƒ½ã®è¨­å®šãƒ»åˆ©ç”¨ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚

## ğŸ“‹ æ©Ÿèƒ½æ¦‚è¦

### é€šçŸ¥ã‚¿ã‚¤ãƒ—

- **ğŸ”´ ç·Šæ€¥ã‚¢ãƒ©ãƒ¼ãƒˆ**: æ¬ èˆªç¢ºå®šãƒ»å±é™ºãƒ¬ãƒ™ãƒ«85%ä»¥ä¸Š
- **ğŸŸ  é«˜ãƒªã‚¹ã‚¯é€šçŸ¥**: ãƒªã‚¹ã‚¯ãƒ¬ãƒ™ãƒ«70%ä»¥ä¸Š  
- **ğŸŸ¡ é‹èˆªé…å»¶é€šçŸ¥**: é…å»¶æƒ…å ±
- **ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³**: 50, 100, 200, 300, 400, 500ä»¶é”æˆæ™‚
- **ğŸ“… æ—¥æ¬¡ã‚µãƒãƒªãƒ¼**: 1æ—¥ã®é‹èˆªçŠ¶æ³ã¾ã¨ã‚

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å½¢å¼

- **ğŸ“± Flex Message**: ãƒªãƒƒãƒãªã‚«ãƒ¼ãƒ‰å½¢å¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
- **ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**: ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ†ã‚­ã‚¹ãƒˆå½¢å¼
- **âš¡ Quick Reply**: ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—è¿”ä¿¡ãƒœã‚¿ãƒ³

### é€šçŸ¥å¯¾è±¡

- **ğŸ‘¤ å€‹äººãƒ¦ãƒ¼ã‚¶ãƒ¼**: å€‹åˆ¥ã®LINEãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥
- **ğŸ‘¥ ã‚°ãƒ«ãƒ¼ãƒ—**: LINEã‚°ãƒ«ãƒ¼ãƒ—ã¸ã®ä¸€æ‹¬é€šçŸ¥
- **ğŸ“¢ ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ**: å‹ã ã¡å…¨å“¡ã¸ã®é…ä¿¡

## ğŸ”§ è¨­å®šæ–¹æ³•

### 1. LINE Messaging APIè¨­å®š

#### LINE Developers ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
1. [LINE Developers](https://developers.line.biz) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. LINEã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³
3. æ–°è¦ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ä½œæˆï¼ˆä¾‹: ãƒ•ã‚§ãƒªãƒ¼äºˆå ±ï¼‰

#### Messaging APIãƒãƒ£ãƒ³ãƒãƒ«ä½œæˆ
1. **æ–°è¦ãƒãƒ£ãƒ³ãƒãƒ«ä½œæˆ** â†’ **Messaging API**ã‚’é¸æŠ
2. ãƒãƒ£ãƒ³ãƒãƒ«æƒ…å ±å…¥åŠ›:
   - **ãƒãƒ£ãƒ³ãƒãƒ«å**: ãƒ•ã‚§ãƒªãƒ¼äºˆå ±Bot
   - **ãƒãƒ£ãƒ³ãƒãƒ«èª¬æ˜**: åŒ—æµ·é“ãƒ•ã‚§ãƒªãƒ¼é‹èˆªäºˆå ±
   - **å¤§æ¥­ç¨®**: æ—…è¡Œãƒ»äº¤é€š
   - **å°æ¥­ç¨®**: æµ·é‹

#### ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—
1. **Basic settings** â†’ **Channel Secret**ã‚’ã‚³ãƒ”ãƒ¼
2. **Messaging API** â†’ **Channel access token**ã‚’ç™ºè¡Œãƒ»ã‚³ãƒ”ãƒ¼

### 2. Botè¨­å®š

#### Messaging APIè¨­å®š
```
- å¿œç­”ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: ç„¡åŠ¹
- ã‚ã„ã•ã¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: æœ‰åŠ¹  
- Webhook: ä¸è¦ï¼ˆãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã®ã¿ï¼‰
```

### 3. ã‚·ã‚¹ãƒ†ãƒ è¨­å®š

```bash
# å¯¾è©±å¼è¨­å®šãƒ„ãƒ¼ãƒ«å®Ÿè¡Œ
python line_setup_guide.py
```

ã¾ãŸã¯ç›´æ¥ã‚³ãƒ¼ãƒ‰ã§è¨­å®š:

```python
from line_notification_system import LINENotificationSystem
from pathlib import Path

# åˆæœŸåŒ–
line_system = LINENotificationSystem(Path("data"))

# Channelè¨­å®š
line_system.setup_line_bot(
    channel_access_token="YOUR_CHANNEL_ACCESS_TOKEN",
    channel_secret="YOUR_CHANNEL_SECRET"
)

# é€šçŸ¥å¯¾è±¡è¿½åŠ 
line_system.add_notification_target("USER_ID", "user")       # å€‹äºº
line_system.add_notification_target("GROUP_ID", "group")     # ã‚°ãƒ«ãƒ¼ãƒ—
```

### 4. ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãƒ»ã‚°ãƒ«ãƒ¼ãƒ—IDå–å¾—

#### ç°¡æ˜“å–å¾—æ–¹æ³•
```python
# Flask + LINE Bot SDKä½¿ç”¨ä¾‹
from flask import Flask, request
from linebot import LineBotApi, WebhookHandler
from linebot.models import MessageEvent, TextMessage

@handler.add(MessageEvent, message=TextMessage)
def handle_message(event):
    user_id = event.source.user_id
    print(f"User ID: {user_id}")  # ã“ã‚Œã‚’ã‚·ã‚¹ãƒ†ãƒ ã«ç™»éŒ²
    
    # ã‚°ãƒ«ãƒ¼ãƒ—ã®å ´åˆ
    if hasattr(event.source, 'group_id'):
        group_id = event.source.group_id
        print(f"Group ID: {group_id}")
```

## ğŸ“± é€šçŸ¥ä¾‹

### é«˜ãƒªã‚¹ã‚¯ã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆFlex Messageï¼‰
```json
{
  "type": "flex",
  "altText": "ğŸŸ  ãƒ•ã‚§ãƒªãƒ¼é‹èˆªäºˆå ± High",
  "contents": {
    "type": "bubble",
    "header": {
      "type": "box",
      "contents": [
        {
          "type": "text", 
          "text": "ğŸŸ  ãƒ•ã‚§ãƒªãƒ¼é‹èˆªäºˆå ±",
          "weight": "bold",
          "color": "#FFFFFF"
        }
      ],
      "backgroundColor": "#FF8000"
    },
    "body": {
      "contents": [
        {
          "type": "text",
          "text": "ğŸš¢ ç¨šå†… â‡” é´›æ³Š"
        },
        {
          "type": "text", 
          "text": "â° 08:00ä¾¿"
        },
        {
          "type": "text",
          "text": "âš ï¸ High (75%)"
        }
      ]
    }
  }
}
```

### æ¬ èˆªã‚¢ãƒ©ãƒ¼ãƒˆï¼ˆãƒ†ã‚­ã‚¹ãƒˆï¼‰
```
ğŸ”´ ãƒ•ã‚§ãƒªãƒ¼æ¬ èˆªã®ãŠçŸ¥ã‚‰ã›

ğŸš¢ èˆªè·¯: ç¨šå†… â‡” é´›æ³Š
â° ä¾¿: 08:00ä¾¿  
ğŸ“ ç†ç”±: å¼·é¢¨ãƒ»é«˜æ³¢ã®ãŸã‚

æœ€æ–°ã®é‹èˆªæƒ…å ±ã‚’ã”ç¢ºèªãã ã•ã„
```

### ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³
```
ğŸ“Š ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³é”æˆ

ğŸ¯ 200ä»¶é”æˆï¼
ğŸ“ˆ ç·ãƒ‡ãƒ¼ã‚¿æ•°: 200ä»¶
ğŸš€ âš¡ ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰äºˆæ¸¬é–‹å§‹ï¼é«˜ç²¾åº¦äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒ
```

## ğŸ› ï¸ é–‹ç™ºè€…å‘ã‘

### ã‚«ã‚¹ã‚¿ãƒ é€šçŸ¥é€ä¿¡

```python
# ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
message = line_system.create_text_message("ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸")
await line_system.broadcast_to_all_targets(message)

# å€‹åˆ¥é€ä¿¡
await line_system.send_line_message(message, "USER_ID", "push")

# äºˆå ±çµæœé€šçŸ¥
forecast_result = {
    "risk_level": "High",
    "risk_score": 75.0,
    "service": {"route_name": "ç¨šå†… â‡” é´›æ³Š", "departure_time": "08:00"},
    "weather_conditions": {"wind_speed": 18.5},
    "recommendation": "æ³¨æ„ãŒå¿…è¦ã§ã™"
}
await line_system.send_risk_alert(forecast_result)
```

### Flex Message ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

```python
# ã‚«ã‚¹ã‚¿ãƒ Flex Message
custom_flex = {
    "type": "flex",
    "altText": "ã‚«ã‚¹ã‚¿ãƒ é€šçŸ¥",
    "contents": {
        "type": "bubble",
        "body": {
            "type": "box",
            "layout": "vertical",
            "contents": [
                {
                    "type": "text",
                    "text": "ã‚«ã‚¹ã‚¿ãƒ å†…å®¹",
                    "weight": "bold"
                }
            ]
        }
    }
}

await line_system.send_line_message(custom_flex)
```

### è¨­å®šã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

```python
# è¨­å®šå¤‰æ›´
line_system.config["notification_settings"]["use_flex_messages"] = True
line_system.config["notification_settings"]["use_quick_reply"] = True
line_system.config["message_format"]["brand_color"] = "#FF6B35"
line_system._save_config(line_system.config)
```

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

**âŒ é€šçŸ¥ãŒé€ä¿¡ã•ã‚Œãªã„**
```bash
# è¨­å®šç¢ºèª
python line_setup_guide.py
# â†’ é¸æŠ: 3 (ç¾åœ¨ã®è¨­å®šç¢ºèª)

# ãƒ­ã‚°ç¢ºèª
tail -f ferry_monitoring.log
```

**âŒ Channel Access Token ã‚¨ãƒ©ãƒ¼**
- ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™ç¢ºèª
- Channel typeãŒMessaging APIã‹ç¢ºèª
- ãƒˆãƒ¼ã‚¯ãƒ³ãŒæ­£ã—ãã‚³ãƒ”ãƒ¼ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

**âŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼IDãŒå–å¾—ã§ããªã„**
- Webhookã®URLè¨­å®šç¢ºèª
- SSLè¨¼æ˜æ›¸ã®æœ‰åŠ¹æ€§ç¢ºèª
- ngrokãªã©ã®ãƒˆãƒ³ãƒãƒ«ãƒ„ãƒ¼ãƒ«ä½¿ç”¨ã‚’æ¤œè¨

### ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰

```python
import logging
logging.basicConfig(level=logging.DEBUG)

# è©³ç´°ãƒ­ã‚°ã§ãƒ‡ãƒãƒƒã‚°
line_system = LINENotificationSystem(data_dir)
```

### é€šçŸ¥åˆ¶é™

- **Push APIåˆ¶é™**: æœˆé–“1000é€šã¾ã§ï¼ˆé–‹ç™ºè€…ãƒ—ãƒ©ãƒ³ï¼‰
- **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é•·**: ãƒ†ã‚­ã‚¹ãƒˆ5000æ–‡å­—ã¾ã§
- **Flex Message**: JSON 10KB ã¾ã§

## ğŸš€ ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ

### ç›£è¦–ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æº

LINEé€šçŸ¥ã¯ä»¥ä¸‹ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è‡ªå‹•é€ä¿¡ã•ã‚Œã¾ã™:

1. **é‹èˆªçŠ¶æ³å¤‰åŒ–æ™‚**: æ¬ èˆªãƒ»é…å»¶ç™ºç”Ÿ
2. **é«˜ãƒªã‚¹ã‚¯æ¤œå‡ºæ™‚**: ãƒªã‚¹ã‚¯ã‚¹ã‚³ã‚¢70%ä»¥ä¸Š  
3. **ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³**: 50, 100, 200, 300, 400, 500ä»¶é”æˆ
4. **æ—¥æ¬¡ã‚µãƒãƒªãƒ¼**: æ¯æ—¥ã®é‹èˆªçµ±è¨ˆ

### äºˆå ±ã‚·ã‚¹ãƒ†ãƒ ã¨ã®é€£æº

```python
from ferry_forecast_ui import FerryForecastUI

ui_system = FerryForecastUI()

# 7æ—¥é–“äºˆå ±ç”Ÿæˆæ™‚ã«é«˜ãƒªã‚¹ã‚¯ä¾¿ã‚’è‡ªå‹•é€šçŸ¥
forecasts = await ui_system.generate_7day_forecasts()
for forecast in forecasts:
    if forecast.risk_score >= 70:
        if hasattr(ui_system.monitoring_system, 'line_system'):
            await ui_system.monitoring_system.line_system.send_risk_alert(forecast)
```

### Discordãƒ»LINEåŒæ™‚é€šçŸ¥

```python
# ä¸¡æ–¹ã®é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ãŒæœ‰åŠ¹ãªå ´åˆã€åŒæ™‚é€ä¿¡
async def send_dual_notification(forecast_result):
    tasks = []
    
    if discord_system:
        tasks.append(discord_system.send_risk_alert(forecast_result))
    
    if line_system:  
        tasks.append(line_system.send_risk_alert(forecast_result))
    
    await asyncio.gather(*tasks)
```

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

### å¿…è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```bash
pip install aiohttp line-bot-sdk flask qrcode pillow
```

### å‚è€ƒãƒªãƒ³ã‚¯

- [LINE Messaging API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://developers.line.biz/ja/docs/messaging-api/)
- [Flex Message Simulator](https://developers.line.biz/flex-simulator/)
- [LINE Bot SDK for Python](https://github.com/line/line-bot-sdk-python)

---

**ğŸ“ ã‚µãƒãƒ¼ãƒˆ**: ã‚·ã‚¹ãƒ†ãƒ çµ±åˆã‚„è¨­å®šã§ã”ä¸æ˜ãªç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€é–‹ç™ºãƒãƒ¼ãƒ ã¾ã§ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚