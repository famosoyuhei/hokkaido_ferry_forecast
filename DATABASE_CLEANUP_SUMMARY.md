# Database Cleanup Summary

**Date**: 2025-12-31
**Action**: Consolidated from 11 databases â†’ 3 active databases

## âœ… Active Databases (Production System)

### 1. `ferry_weather_forecast.db` (3.5 MB)
**Purpose**: Main forecast system
**Contents**:
- Weather forecasts (577 records) - JMA + Open-Meteo
- Cancellation risk predictions (19,614 records)
- Forecast collection logs (24 records)

**Updated by**:
- `weather_forecast_collector.py` (Railway cron: 4x/day)

---

### 2. `heartland_ferry_real_data.db` (1.0 MB)
**Purpose**: Real operations tracking
**Contents**:
- Ferry status (730 records) - Daily scraping
- Ferry status enhanced (16 records) - With weather data
- Daily summary (71 records)
- Historical operations (12 records) - Migrated from ferry_actual_operations.db
- Scraping logs (76 records)

**Updated by**:
- `improved_ferry_collector.py` (Railway cron: daily 6:00 AM JST)

**Last update**: 2025-12-31 (Active today!)

---

### 3. `notifications.db` (28 KB)
**Purpose**: Push notification system (future feature)
**Contents**:
- Alert templates
- User subscriptions (demo data)
- Delivery logs

**Status**: Reserved for future development
**Related files**: `push_notification_service.py` (uncommitted)

---

## ğŸ—‘ï¸ Deleted Databases (Moved to Backup)

The following 8 databases were moved to `database_backups/20251231_104458/`:

### Legacy/Test Databases
1. **ferry_actual_operations.db** (32 KB)
   - Reason: Data migrated to heartland_ferry_real_data.db
   - Last update: 2025-10-28 (stopped working)

2. **ferry_forecast_data.db** (72 KB)
   - Reason: Test/simulation data only
   - Generated by: ferry_data_collector.py (legacy script)

3. **ferry_timetable_data.db** (28 KB)
   - Reason: Not used by current system
   - Current system extracts schedules from live status page

4. **ferry_data.db** (12 KB)
   - Reason: Nearly empty test database (2 records)

### Future Feature Databases (Not Currently Active)
5. **rishiri_flight_data.db** (20 KB)
   - Reason: Flight tracking feature on hold
   - Note: May be needed for future Rishiri Airport app

6. **api_usage.db** (24 KB)
   - Reason: Empty, not currently monitoring API costs

### Demo/Test Databases
7. **transport_predictions.db** (16 KB)
   - Reason: Empty database

8. **accuracy_analysis.db** (56 KB)
   - Reason: Demo data only (100 test predictions)

---

## ğŸ“Š Storage Impact

**Before**: 11 databases, ~4.8 MB total
**After**: 3 databases, ~4.6 MB total
**Cleaned**: 8 databases, ~260 KB moved to backup

---

## ğŸ¯ System Architecture (Current)

```
Data Collection (Automated)
â”œâ”€â”€ weather_forecast_collector.py
â”‚   â”œâ”€â”€ JMA API (Japan Meteorological Agency)
â”‚   â”œâ”€â”€ Open-Meteo API
â”‚   â””â”€â”€ â†’ ferry_weather_forecast.db
â”‚
â””â”€â”€ improved_ferry_collector.py
    â”œâ”€â”€ Heartland Ferry status page
    â”œâ”€â”€ Open-Meteo API (current weather)
    â””â”€â”€ â†’ heartland_ferry_real_data.db

Web Dashboard
â””â”€â”€ forecast_dashboard.py
    â”œâ”€â”€ Reads: ferry_weather_forecast.db
    â”œâ”€â”€ Reads: heartland_ferry_real_data.db (for stats)
    â””â”€â”€ Serves: PWA web app

Future Features
â””â”€â”€ push_notification_service.py (planned)
    â””â”€â”€ â†’ notifications.db
```

---

## ğŸ”„ Railway Cron Jobs (Production)

| Job | Script | Schedule (UTC) | Purpose |
|-----|--------|----------------|---------|
| ferry_collection | improved_ferry_collector.py | 0 21 * * * | Daily operations scraping (6 AM JST) |
| forecast_collection_morning | weather_forecast_collector.py | 0 20 * * * | 7-day forecasts (5 AM JST) |
| forecast_collection_midday | weather_forecast_collector.py | 0 2 * * * | 7-day forecasts (11 AM JST) |
| forecast_collection_evening | weather_forecast_collector.py | 0 8 * * * | 7-day forecasts (5 PM JST) |
| forecast_collection_night | weather_forecast_collector.py | 0 14 * * * | 7-day forecasts (11 PM JST) |
| accuracy_tracking | accuracy_tracker.py | 0 22 * * * | Verify predictions (7 AM JST) |
| notification_morning | notification_service.py | 30 21 * * * | Send alerts (6:30 AM JST) |

---

## âœ… Next Steps

1. Verify the system works correctly with 3 databases
2. Once confirmed, delete backup: `database_backups/20251231_104458/`
3. Continue to Question 3: Railway environment verification
4. Create comprehensive CLAUDE.md documentation

---

## ğŸ“ Notes

- All historical data from ferry_actual_operations.db has been preserved
- Backup directory can be safely deleted after testing
- notification_service.py and accuracy_tracker.py may need adjustment if they reference old databases
